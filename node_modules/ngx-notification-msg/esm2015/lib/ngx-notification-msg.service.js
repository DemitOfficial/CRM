/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ApplicationRef, ComponentFactoryResolver, Injectable, Injector } from '@angular/core';
import { NgxNotificationMsgComponent } from './ngx-notification-msg.component';
import * as i0 from "@angular/core";
import * as ɵngcc0 from '@angular/core';
export class NgxNotificationMsgService {
    /**
     * @param {?} componentFactoryResolver
     * @param {?} appRef
     * @param {?} injector
     */
    constructor(componentFactoryResolver, appRef, injector) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.appRef = appRef;
        this.injector = injector;
        this.defaultContainer = document.querySelector('body');
        this.containerToChildComponentsRef = new Map();
    }
    /**
     * @private
     * @param {?} componentFactoryResolver
     * @param {?} appRef
     * @param {?} injector
     * @param {?} container
     * @return {?}
     */
    static appendChildComponentRef(componentFactoryResolver, appRef, injector, container) {
        /** @type {?} */
        const childComponentRef = componentFactoryResolver
            .resolveComponentFactory(NgxNotificationMsgComponent)
            .create(injector);
        /** @type {?} */
        const childDomElem = (/** @type {?} */ (((/** @type {?} */ (childComponentRef.hostView)))
            .rootNodes[0]));
        appRef.attachView(childComponentRef.hostView);
        container.appendChild(childDomElem);
        return childComponentRef;
    }
    /**
     * @private
     * @param {?} inputsConfig
     * @param {?} componentRef
     * @return {?}
     */
    static attachConfig(inputsConfig, componentRef) {
        Object.keys(inputsConfig).forEach((/**
         * @param {?} key
         * @return {?}
         */
        key => {
            componentRef.instance[key] = inputsConfig[key];
        }));
    }
    /**
     * @private
     * @param {?} container
     * @param {?} containerToChildComponentsRef
     * @param {?} childComponentRef
     * @return {?}
     */
    static addChildComponentRef(container, containerToChildComponentsRef, childComponentRef) {
        if (containerToChildComponentsRef.has(container)) {
            containerToChildComponentsRef.get(container).push(childComponentRef);
        }
        else {
            containerToChildComponentsRef.set(container, [childComponentRef]);
        }
    }
    /**
     * @private
     * @param {?} appRef
     * @param {?} containerToChildComponentsRef
     * @param {?} componentRef
     * @return {?}
     */
    static subscribeToComponentDestroyEvent(appRef, containerToChildComponentsRef, componentRef) {
        /** @type {?} */
        const sub = componentRef.instance.destroy.subscribe((/**
         * @return {?}
         */
        () => {
            sub.unsubscribe();
            NgxNotificationMsgService.destroy(appRef, componentRef);
            NgxNotificationMsgService.removeChildComponentRef(containerToChildComponentsRef, componentRef);
            NgxNotificationMsgService.updateComponentsIndexesOnDestroy(containerToChildComponentsRef);
        }));
    }
    /**
     * @private
     * @param {?} appRef
     * @param {?} componentRef
     * @return {?}
     */
    static destroy(appRef, componentRef) {
        appRef.detachView(componentRef.hostView);
        componentRef.destroy();
    }
    /**
     * @private
     * @param {?} containerToChildComponentsRef
     * @return {?}
     */
    static updateComponentsIndexesOnDestroy(containerToChildComponentsRef) {
        containerToChildComponentsRef.forEach((/**
         * @param {?} value
         * @param {?} key
         * @return {?}
         */
        (value, key) => {
            /** @type {?} */
            let total = containerToChildComponentsRef.get(key).length - 1;
            containerToChildComponentsRef.get(key).forEach((/**
             * @param {?} __0
             * @return {?}
             */
            ({ instance }) => {
                instance.index = total--;
            }));
        }));
    }
    /**
     * @private
     * @param {?} containerToChildComponentsRef
     * @param {?} componentRef
     * @return {?}
     */
    static removeChildComponentRef(containerToChildComponentsRef, componentRef) {
        containerToChildComponentsRef.forEach((/**
         * @param {?} value
         * @param {?} key
         * @return {?}
         */
        (value, key) => {
            containerToChildComponentsRef.set(key, [...containerToChildComponentsRef.get(key).filter((/**
                 * @param {?} _
                 * @return {?}
                 */
                _ => _ !== componentRef))]);
        }));
    }
    /**
     * @private
     * @param {?} containerToChildComponentsRef
     * @return {?}
     */
    static updateComponentsIndexesOnOpen(containerToChildComponentsRef) {
        containerToChildComponentsRef.forEach((/**
         * @param {?} value
         * @param {?} key
         * @return {?}
         */
        (value, key) => {
            /** @type {?} */
            let total = containerToChildComponentsRef.get(key).length;
            containerToChildComponentsRef.get(key).forEach((/**
             * @param {?} __0
             * @return {?}
             */
            ({ instance }) => {
                instance.index = --total;
            }));
        }));
    }
    /**
     * @param {?} inputsConfig
     * @param {?=} element
     * @return {?}
     */
    open(inputsConfig, element) {
        /** @type {?} */
        const container = element ? element : this.defaultContainer;
        /** @type {?} */
        const childComponentRef = NgxNotificationMsgService.appendChildComponentRef(this.componentFactoryResolver, this.appRef, this.injector, container);
        NgxNotificationMsgService.attachConfig(inputsConfig, childComponentRef);
        NgxNotificationMsgService.addChildComponentRef(container, this.containerToChildComponentsRef, childComponentRef);
        NgxNotificationMsgService.subscribeToComponentDestroyEvent(this.appRef, this.containerToChildComponentsRef, childComponentRef);
        NgxNotificationMsgService.updateComponentsIndexesOnOpen(this.containerToChildComponentsRef);
    }
}
NgxNotificationMsgService.ɵfac = function NgxNotificationMsgService_Factory(t) { return new (t || NgxNotificationMsgService)(ɵngcc0.ɵɵinject(ɵngcc0.ComponentFactoryResolver), ɵngcc0.ɵɵinject(ɵngcc0.ApplicationRef), ɵngcc0.ɵɵinject(ɵngcc0.Injector)); };
NgxNotificationMsgService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: NgxNotificationMsgService, factory: NgxNotificationMsgService.ɵfac, providedIn: 'root' });
/** @nocollapse */
NgxNotificationMsgService.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: ApplicationRef },
    { type: Injector }
];
/** @nocollapse */ NgxNotificationMsgService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function NgxNotificationMsgService_Factory() { return new NgxNotificationMsgService(i0.ɵɵinject(i0.ComponentFactoryResolver), i0.ɵɵinject(i0.ApplicationRef), i0.ɵɵinject(i0.INJECTOR)); }, token: NgxNotificationMsgService, providedIn: "root" });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NgxNotificationMsgService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc0.ComponentFactoryResolver }, { type: ɵngcc0.ApplicationRef }, { type: ɵngcc0.Injector }]; }, null); })();
if (false) {
    /**
     * @type {?}
     * @private
     */
    NgxNotificationMsgService.prototype.defaultContainer;
    /**
     * @type {?}
     * @private
     */
    NgxNotificationMsgService.prototype.containerToChildComponentsRef;
    /**
     * @type {?}
     * @private
     */
    NgxNotificationMsgService.prototype.componentFactoryResolver;
    /**
     * @type {?}
     * @private
     */
    NgxNotificationMsgService.prototype.appRef;
    /**
     * @type {?}
     * @private
     */
    NgxNotificationMsgService.prototype.injector;
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LW5vdGlmaWNhdGlvbi1tc2cuc2VydmljZS5qcyIsInNvdXJjZXMiOlsibmd4LW5vdGlmaWNhdGlvbi1tc2cvbGliL25neC1ub3RpZmljYXRpb24tbXNnLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBQyxjQUFjLEVBQUUsd0JBQXdCLEVBQWlDLFVBQVUsRUFBRSxRQUFRLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDNUgsT0FBTyxFQUE0QiwyQkFBMkIsRUFBQyxNQUFNLGtDQUFrQyxDQUFDO0FBQ3hHOztBQUlBLE1BQU0sT0FBTyx5QkFBeUI7QUFDdEM7QUFDTztBQUEyQztBQUMvQztBQUEyQjtBQUFRLElBRWxDLFlBQTZCLHdCQUFrRCxFQUNsRCxNQUFzQixFQUN0QixRQUFrQjtBQUNuRCxRQUhpQyw2QkFBd0IsR0FBeEIsd0JBQXdCLENBQTBCO0FBQUMsUUFDbkQsV0FBTSxHQUFOLE1BQU0sQ0FBZ0I7QUFBQyxRQUN2QixhQUFRLEdBQVIsUUFBUSxDQUFVO0FBQUMsUUFML0IscUJBQWdCLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUN2RSxRQUFxQixrQ0FBNkIsR0FBRyxJQUFJLEdBQUcsRUFBZ0MsQ0FBQztBQUM3RixJQUlJLENBQUM7QUFDTDtBQUNPO0FBQWdCO0FBQTJDO0FBQXlCO0FBQ3BFO0FBQTRCO0FBQ2hEO0FBQVEsSUFGQyxNQUFNLENBQUMsdUJBQXVCLENBQUMsd0JBQWtELEVBQ2xELE1BQXNCLEVBQ3RCLFFBQWtCLEVBQ2xCLFNBQWtCO0FBQUk7QUFDM0QsY0FBUSxpQkFBaUIsR0FBRyx3QkFBd0I7QUFDMUQsYUFBYSx1QkFBdUIsQ0FBQywyQkFBMkIsQ0FBQztBQUNqRSxhQUFhLE1BQU0sQ0FBQyxRQUFRLENBQUM7QUFDN0I7QUFBeUIsY0FBWCxZQUFZLEdBQUcsbUJBQUEsQ0FBQyxtQkFBQSxpQkFBaUIsQ0FBQyxRQUFRLEVBQXdCLENBQUM7QUFDakYsYUFB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aEMsNkRBQW1FO0FBQUM7QUFDN0U7QUFBaUI7QUFBZ0I7QUFBUSxJQUFoQywyQ0FBdUM7QUFBQztBQUNqRDtBQUFpQjtBQUFnQjtBQUFRLElBQWhDLDZDQUFtQztBQUFDO0FBQUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0FwcGxpY2F0aW9uUmVmLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIENvbXBvbmVudFJlZiwgRW1iZWRkZWRWaWV3UmVmLCBJbmplY3RhYmxlLCBJbmplY3Rvcn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0lOZ3hOb3RpZmljYXRpb25Nc2dDb25maWcsIE5neE5vdGlmaWNhdGlvbk1zZ0NvbXBvbmVudH0gZnJvbSAnLi9uZ3gtbm90aWZpY2F0aW9uLW1zZy5jb21wb25lbnQnO1xuXG5ASW5qZWN0YWJsZSh7XG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIE5neE5vdGlmaWNhdGlvbk1zZ1NlcnZpY2Uge1xuXG4gICAgcHJpdmF0ZSByZWFkb25seSBkZWZhdWx0Q29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWYgPSBuZXcgTWFwPEVsZW1lbnQsIENoaWxkQ29tcG9uZW50UmVmW10+KCk7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgcmVhZG9ubHkgYXBwUmVmOiBBcHBsaWNhdGlvblJlZixcbiAgICAgICAgICAgICAgICBwcml2YXRlIHJlYWRvbmx5IGluamVjdG9yOiBJbmplY3Rvcikge1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIGFwcGVuZENoaWxkQ29tcG9uZW50UmVmKGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcFJlZjogQXBwbGljYXRpb25SZWYsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5qZWN0b3I6IEluamVjdG9yLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogRWxlbWVudCk6IENoaWxkQ29tcG9uZW50UmVmIHtcbiAgICAgICAgY29uc3QgY2hpbGRDb21wb25lbnRSZWYgPSBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXJcbiAgICAgICAgICAgIC5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShOZ3hOb3RpZmljYXRpb25Nc2dDb21wb25lbnQpXG4gICAgICAgICAgICAuY3JlYXRlKGluamVjdG9yKTtcbiAgICAgICAgY29uc3QgY2hpbGREb21FbGVtID0gKGNoaWxkQ29tcG9uZW50UmVmLmhvc3RWaWV3IGFzIEVtYmVkZGVkVmlld1JlZjxhbnk+KVxuICAgICAgICAgICAgLnJvb3ROb2Rlc1swXSBhcyBIVE1MRWxlbWVudDtcblxuICAgICAgICBhcHBSZWYuYXR0YWNoVmlldyhjaGlsZENvbXBvbmVudFJlZi5ob3N0Vmlldyk7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjaGlsZERvbUVsZW0pO1xuXG4gICAgICAgIHJldHVybiBjaGlsZENvbXBvbmVudFJlZjtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBhdHRhY2hDb25maWcoaW5wdXRzQ29uZmlnOiBJTmd4Tm90aWZpY2F0aW9uTXNnQ29uZmlnLCBjb21wb25lbnRSZWYpOiB2b2lkIHtcbiAgICAgICAgT2JqZWN0LmtleXMoaW5wdXRzQ29uZmlnKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgICAgICBjb21wb25lbnRSZWYuaW5zdGFuY2Vba2V5XSA9IGlucHV0c0NvbmZpZ1trZXldO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBhZGRDaGlsZENvbXBvbmVudFJlZihjb250YWluZXI6IEVsZW1lbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWY6IENvbnRhaW5lclRvQ29tcG9uZW50c1JlZixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZENvbXBvbmVudFJlZjogQ2hpbGRDb21wb25lbnRSZWYpOiB2b2lkIHtcbiAgICAgICAgaWYgKGNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmLmhhcyhjb250YWluZXIpKSB7XG4gICAgICAgICAgICBjb250YWluZXJUb0NoaWxkQ29tcG9uZW50c1JlZi5nZXQoY29udGFpbmVyKS5wdXNoKGNoaWxkQ29tcG9uZW50UmVmKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmLnNldChjb250YWluZXIsIFtjaGlsZENvbXBvbmVudFJlZl0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgc3Vic2NyaWJlVG9Db21wb25lbnREZXN0cm95RXZlbnQoYXBwUmVmOiBBcHBsaWNhdGlvblJlZixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXJUb0NoaWxkQ29tcG9uZW50c1JlZjogQ29udGFpbmVyVG9Db21wb25lbnRzUmVmLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudFJlZjogQ2hpbGRDb21wb25lbnRSZWYpOiB2b2lkIHtcbiAgICAgICAgY29uc3Qgc3ViID0gY29tcG9uZW50UmVmLmluc3RhbmNlLmRlc3Ryb3kuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIHN1Yi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgTmd4Tm90aWZpY2F0aW9uTXNnU2VydmljZS5kZXN0cm95KGFwcFJlZiwgY29tcG9uZW50UmVmKTtcbiAgICAgICAgICAgIE5neE5vdGlmaWNhdGlvbk1zZ1NlcnZpY2UucmVtb3ZlQ2hpbGRDb21wb25lbnRSZWYoY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWYsIGNvbXBvbmVudFJlZik7XG4gICAgICAgICAgICBOZ3hOb3RpZmljYXRpb25Nc2dTZXJ2aWNlLnVwZGF0ZUNvbXBvbmVudHNJbmRleGVzT25EZXN0cm95KGNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZGVzdHJveShhcHBSZWY6IEFwcGxpY2F0aW9uUmVmLCBjb21wb25lbnRSZWY6IENoaWxkQ29tcG9uZW50UmVmKTogdm9pZCB7XG4gICAgICAgIGFwcFJlZi5kZXRhY2hWaWV3KGNvbXBvbmVudFJlZi5ob3N0Vmlldyk7XG4gICAgICAgIGNvbXBvbmVudFJlZi5kZXN0cm95KCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgdXBkYXRlQ29tcG9uZW50c0luZGV4ZXNPbkRlc3Ryb3koY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWY6IENvbnRhaW5lclRvQ29tcG9uZW50c1JlZik6IHZvaWQge1xuICAgICAgICBjb250YWluZXJUb0NoaWxkQ29tcG9uZW50c1JlZi5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiB7XG4gICAgICAgICAgICBsZXQgdG90YWwgPSBjb250YWluZXJUb0NoaWxkQ29tcG9uZW50c1JlZi5nZXQoa2V5KS5sZW5ndGggLSAxO1xuICAgICAgICAgICAgY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWYuZ2V0KGtleSkuZm9yRWFjaCgoe2luc3RhbmNlfSkgPT4ge1xuICAgICAgICAgICAgICAgIGluc3RhbmNlLmluZGV4ID0gdG90YWwtLTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyByZW1vdmVDaGlsZENvbXBvbmVudFJlZihjb250YWluZXJUb0NoaWxkQ29tcG9uZW50c1JlZjogQ29udGFpbmVyVG9Db21wb25lbnRzUmVmLCBjb21wb25lbnRSZWY6IENoaWxkQ29tcG9uZW50UmVmKTogdm9pZCB7XG4gICAgICAgIGNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHtcbiAgICAgICAgICAgIGNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmLnNldChrZXksIFsuLi5jb250YWluZXJUb0NoaWxkQ29tcG9uZW50c1JlZi5nZXQoa2V5KS5maWx0ZXIoXyA9PiBfICE9PSBjb21wb25lbnRSZWYpXSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIHVwZGF0ZUNvbXBvbmVudHNJbmRleGVzT25PcGVuKGNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmOiBDb250YWluZXJUb0NvbXBvbmVudHNSZWYpOiB2b2lkIHtcbiAgICAgICAgY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWYuZm9yRWFjaCgodmFsdWUsIGtleSkgPT4ge1xuICAgICAgICAgICAgbGV0IHRvdGFsID0gY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWYuZ2V0KGtleSkubGVuZ3RoO1xuICAgICAgICAgICAgY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWYuZ2V0KGtleSkuZm9yRWFjaCgoe2luc3RhbmNlfSkgPT4ge1xuICAgICAgICAgICAgICAgIGluc3RhbmNlLmluZGV4ID0gLS10b3RhbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBvcGVuKGlucHV0c0NvbmZpZzogSU5neE5vdGlmaWNhdGlvbk1zZ0NvbmZpZywgZWxlbWVudD86IEVsZW1lbnQpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gZWxlbWVudCA/IGVsZW1lbnQgOiB0aGlzLmRlZmF1bHRDb250YWluZXI7XG4gICAgICAgIGNvbnN0IGNoaWxkQ29tcG9uZW50UmVmID0gTmd4Tm90aWZpY2F0aW9uTXNnU2VydmljZS5hcHBlbmRDaGlsZENvbXBvbmVudFJlZihcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICAgICAgICAgICAgdGhpcy5hcHBSZWYsXG4gICAgICAgICAgICB0aGlzLmluamVjdG9yLFxuICAgICAgICAgICAgY29udGFpbmVyXG4gICAgICAgICk7XG5cbiAgICAgICAgTmd4Tm90aWZpY2F0aW9uTXNnU2VydmljZS5hdHRhY2hDb25maWcoaW5wdXRzQ29uZmlnLCBjaGlsZENvbXBvbmVudFJlZik7XG4gICAgICAgIE5neE5vdGlmaWNhdGlvbk1zZ1NlcnZpY2UuYWRkQ2hpbGRDb21wb25lbnRSZWYoY29udGFpbmVyLCB0aGlzLmNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmLCBjaGlsZENvbXBvbmVudFJlZik7XG4gICAgICAgIE5neE5vdGlmaWNhdGlvbk1zZ1NlcnZpY2Uuc3Vic2NyaWJlVG9Db21wb25lbnREZXN0cm95RXZlbnQodGhpcy5hcHBSZWYsIHRoaXMuY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWYsIGNoaWxkQ29tcG9uZW50UmVmKTtcbiAgICAgICAgTmd4Tm90aWZpY2F0aW9uTXNnU2VydmljZS51cGRhdGVDb21wb25lbnRzSW5kZXhlc09uT3Blbih0aGlzLmNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmKTtcbiAgICB9XG59XG5cbnR5cGUgQ2hpbGRDb21wb25lbnRSZWYgPSBDb21wb25lbnRSZWY8Tmd4Tm90aWZpY2F0aW9uTXNnQ29tcG9uZW50PjtcbnR5cGUgQ29udGFpbmVyVG9Db21wb25lbnRzUmVmID0gTWFwPEVsZW1lbnQsIENoaWxkQ29tcG9uZW50UmVmW10+O1xuIl19