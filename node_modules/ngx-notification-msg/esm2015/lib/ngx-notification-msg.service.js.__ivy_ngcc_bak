/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ApplicationRef, ComponentFactoryResolver, Injectable, Injector } from '@angular/core';
import { NgxNotificationMsgComponent } from './ngx-notification-msg.component';
import * as i0 from "@angular/core";
export class NgxNotificationMsgService {
    /**
     * @param {?} componentFactoryResolver
     * @param {?} appRef
     * @param {?} injector
     */
    constructor(componentFactoryResolver, appRef, injector) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.appRef = appRef;
        this.injector = injector;
        this.defaultContainer = document.querySelector('body');
        this.containerToChildComponentsRef = new Map();
    }
    /**
     * @private
     * @param {?} componentFactoryResolver
     * @param {?} appRef
     * @param {?} injector
     * @param {?} container
     * @return {?}
     */
    static appendChildComponentRef(componentFactoryResolver, appRef, injector, container) {
        /** @type {?} */
        const childComponentRef = componentFactoryResolver
            .resolveComponentFactory(NgxNotificationMsgComponent)
            .create(injector);
        /** @type {?} */
        const childDomElem = (/** @type {?} */ (((/** @type {?} */ (childComponentRef.hostView)))
            .rootNodes[0]));
        appRef.attachView(childComponentRef.hostView);
        container.appendChild(childDomElem);
        return childComponentRef;
    }
    /**
     * @private
     * @param {?} inputsConfig
     * @param {?} componentRef
     * @return {?}
     */
    static attachConfig(inputsConfig, componentRef) {
        Object.keys(inputsConfig).forEach((/**
         * @param {?} key
         * @return {?}
         */
        key => {
            componentRef.instance[key] = inputsConfig[key];
        }));
    }
    /**
     * @private
     * @param {?} container
     * @param {?} containerToChildComponentsRef
     * @param {?} childComponentRef
     * @return {?}
     */
    static addChildComponentRef(container, containerToChildComponentsRef, childComponentRef) {
        if (containerToChildComponentsRef.has(container)) {
            containerToChildComponentsRef.get(container).push(childComponentRef);
        }
        else {
            containerToChildComponentsRef.set(container, [childComponentRef]);
        }
    }
    /**
     * @private
     * @param {?} appRef
     * @param {?} containerToChildComponentsRef
     * @param {?} componentRef
     * @return {?}
     */
    static subscribeToComponentDestroyEvent(appRef, containerToChildComponentsRef, componentRef) {
        /** @type {?} */
        const sub = componentRef.instance.destroy.subscribe((/**
         * @return {?}
         */
        () => {
            sub.unsubscribe();
            NgxNotificationMsgService.destroy(appRef, componentRef);
            NgxNotificationMsgService.removeChildComponentRef(containerToChildComponentsRef, componentRef);
            NgxNotificationMsgService.updateComponentsIndexesOnDestroy(containerToChildComponentsRef);
        }));
    }
    /**
     * @private
     * @param {?} appRef
     * @param {?} componentRef
     * @return {?}
     */
    static destroy(appRef, componentRef) {
        appRef.detachView(componentRef.hostView);
        componentRef.destroy();
    }
    /**
     * @private
     * @param {?} containerToChildComponentsRef
     * @return {?}
     */
    static updateComponentsIndexesOnDestroy(containerToChildComponentsRef) {
        containerToChildComponentsRef.forEach((/**
         * @param {?} value
         * @param {?} key
         * @return {?}
         */
        (value, key) => {
            /** @type {?} */
            let total = containerToChildComponentsRef.get(key).length - 1;
            containerToChildComponentsRef.get(key).forEach((/**
             * @param {?} __0
             * @return {?}
             */
            ({ instance }) => {
                instance.index = total--;
            }));
        }));
    }
    /**
     * @private
     * @param {?} containerToChildComponentsRef
     * @param {?} componentRef
     * @return {?}
     */
    static removeChildComponentRef(containerToChildComponentsRef, componentRef) {
        containerToChildComponentsRef.forEach((/**
         * @param {?} value
         * @param {?} key
         * @return {?}
         */
        (value, key) => {
            containerToChildComponentsRef.set(key, [...containerToChildComponentsRef.get(key).filter((/**
                 * @param {?} _
                 * @return {?}
                 */
                _ => _ !== componentRef))]);
        }));
    }
    /**
     * @private
     * @param {?} containerToChildComponentsRef
     * @return {?}
     */
    static updateComponentsIndexesOnOpen(containerToChildComponentsRef) {
        containerToChildComponentsRef.forEach((/**
         * @param {?} value
         * @param {?} key
         * @return {?}
         */
        (value, key) => {
            /** @type {?} */
            let total = containerToChildComponentsRef.get(key).length;
            containerToChildComponentsRef.get(key).forEach((/**
             * @param {?} __0
             * @return {?}
             */
            ({ instance }) => {
                instance.index = --total;
            }));
        }));
    }
    /**
     * @param {?} inputsConfig
     * @param {?=} element
     * @return {?}
     */
    open(inputsConfig, element) {
        /** @type {?} */
        const container = element ? element : this.defaultContainer;
        /** @type {?} */
        const childComponentRef = NgxNotificationMsgService.appendChildComponentRef(this.componentFactoryResolver, this.appRef, this.injector, container);
        NgxNotificationMsgService.attachConfig(inputsConfig, childComponentRef);
        NgxNotificationMsgService.addChildComponentRef(container, this.containerToChildComponentsRef, childComponentRef);
        NgxNotificationMsgService.subscribeToComponentDestroyEvent(this.appRef, this.containerToChildComponentsRef, childComponentRef);
        NgxNotificationMsgService.updateComponentsIndexesOnOpen(this.containerToChildComponentsRef);
    }
}
NgxNotificationMsgService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
NgxNotificationMsgService.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: ApplicationRef },
    { type: Injector }
];
/** @nocollapse */ NgxNotificationMsgService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function NgxNotificationMsgService_Factory() { return new NgxNotificationMsgService(i0.ɵɵinject(i0.ComponentFactoryResolver), i0.ɵɵinject(i0.ApplicationRef), i0.ɵɵinject(i0.INJECTOR)); }, token: NgxNotificationMsgService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    NgxNotificationMsgService.prototype.defaultContainer;
    /**
     * @type {?}
     * @private
     */
    NgxNotificationMsgService.prototype.containerToChildComponentsRef;
    /**
     * @type {?}
     * @private
     */
    NgxNotificationMsgService.prototype.componentFactoryResolver;
    /**
     * @type {?}
     * @private
     */
    NgxNotificationMsgService.prototype.appRef;
    /**
     * @type {?}
     * @private
     */
    NgxNotificationMsgService.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LW5vdGlmaWNhdGlvbi1tc2cuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1ub3RpZmljYXRpb24tbXNnLyIsInNvdXJjZXMiOlsibGliL25neC1ub3RpZmljYXRpb24tbXNnLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBQyxjQUFjLEVBQUUsd0JBQXdCLEVBQWlDLFVBQVUsRUFBRSxRQUFRLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDNUgsT0FBTyxFQUE0QiwyQkFBMkIsRUFBQyxNQUFNLGtDQUFrQyxDQUFDOztBQUt4RyxNQUFNLE9BQU8seUJBQXlCOzs7Ozs7SUFLbEMsWUFBNkIsd0JBQWtELEVBQ2xELE1BQXNCLEVBQ3RCLFFBQWtCO1FBRmxCLDZCQUF3QixHQUF4Qix3QkFBd0IsQ0FBMEI7UUFDbEQsV0FBTSxHQUFOLE1BQU0sQ0FBZ0I7UUFDdEIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUw5QixxQkFBZ0IsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2xELGtDQUE2QixHQUFHLElBQUksR0FBRyxFQUFnQyxDQUFDO0lBS3pGLENBQUM7Ozs7Ozs7OztJQUVPLE1BQU0sQ0FBQyx1QkFBdUIsQ0FBQyx3QkFBa0QsRUFDbEQsTUFBc0IsRUFDdEIsUUFBa0IsRUFDbEIsU0FBa0I7O2NBQy9DLGlCQUFpQixHQUFHLHdCQUF3QjthQUM3Qyx1QkFBdUIsQ0FBQywyQkFBMkIsQ0FBQzthQUNwRCxNQUFNLENBQUMsUUFBUSxDQUFDOztjQUNmLFlBQVksR0FBRyxtQkFBQSxDQUFDLG1CQUFBLGlCQUFpQixDQUFDLFFBQVEsRUFBd0IsQ0FBQzthQUNwRSxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQWU7UUFFaEMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUM5QyxTQUFTLENBQUMsV0FBVyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FB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bnQiOlsiaW1wb3J0IHtBcHBsaWNhdGlvblJlZiwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBDb21wb25lbnRSZWYsIEVtYmVkZGVkVmlld1JlZiwgSW5qZWN0YWJsZSwgSW5qZWN0b3J9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtJTmd4Tm90aWZpY2F0aW9uTXNnQ29uZmlnLCBOZ3hOb3RpZmljYXRpb25Nc2dDb21wb25lbnR9IGZyb20gJy4vbmd4LW5vdGlmaWNhdGlvbi1tc2cuY29tcG9uZW50JztcblxuQEluamVjdGFibGUoe1xuICAgIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBOZ3hOb3RpZmljYXRpb25Nc2dTZXJ2aWNlIHtcblxuICAgIHByaXZhdGUgcmVhZG9ubHkgZGVmYXVsdENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcbiAgICBwcml2YXRlIHJlYWRvbmx5IGNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmID0gbmV3IE1hcDxFbGVtZW50LCBDaGlsZENvbXBvbmVudFJlZltdPigpO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgICAgICAgICAgICAgICBwcml2YXRlIHJlYWRvbmx5IGFwcFJlZjogQXBwbGljYXRpb25SZWYsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSByZWFkb25seSBpbmplY3RvcjogSW5qZWN0b3IpIHtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBhcHBlbmRDaGlsZENvbXBvbmVudFJlZihjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBSZWY6IEFwcGxpY2F0aW9uUmVmLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluamVjdG9yOiBJbmplY3RvcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXI6IEVsZW1lbnQpOiBDaGlsZENvbXBvbmVudFJlZiB7XG4gICAgICAgIGNvbnN0IGNoaWxkQ29tcG9uZW50UmVmID0gY29tcG9uZW50RmFjdG9yeVJlc29sdmVyXG4gICAgICAgICAgICAucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoTmd4Tm90aWZpY2F0aW9uTXNnQ29tcG9uZW50KVxuICAgICAgICAgICAgLmNyZWF0ZShpbmplY3Rvcik7XG4gICAgICAgIGNvbnN0IGNoaWxkRG9tRWxlbSA9IChjaGlsZENvbXBvbmVudFJlZi5ob3N0VmlldyBhcyBFbWJlZGRlZFZpZXdSZWY8YW55PilcbiAgICAgICAgICAgIC5yb290Tm9kZXNbMF0gYXMgSFRNTEVsZW1lbnQ7XG5cbiAgICAgICAgYXBwUmVmLmF0dGFjaFZpZXcoY2hpbGRDb21wb25lbnRSZWYuaG9zdFZpZXcpO1xuICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY2hpbGREb21FbGVtKTtcblxuICAgICAgICByZXR1cm4gY2hpbGRDb21wb25lbnRSZWY7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgYXR0YWNoQ29uZmlnKGlucHV0c0NvbmZpZzogSU5neE5vdGlmaWNhdGlvbk1zZ0NvbmZpZywgY29tcG9uZW50UmVmKTogdm9pZCB7XG4gICAgICAgIE9iamVjdC5rZXlzKGlucHV0c0NvbmZpZykuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgICAgY29tcG9uZW50UmVmLmluc3RhbmNlW2tleV0gPSBpbnB1dHNDb25maWdba2V5XTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgYWRkQ2hpbGRDb21wb25lbnRSZWYoY29udGFpbmVyOiBFbGVtZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmOiBDb250YWluZXJUb0NvbXBvbmVudHNSZWYsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRDb21wb25lbnRSZWY6IENoaWxkQ29tcG9uZW50UmVmKTogdm9pZCB7XG4gICAgICAgIGlmIChjb250YWluZXJUb0NoaWxkQ29tcG9uZW50c1JlZi5oYXMoY29udGFpbmVyKSkge1xuICAgICAgICAgICAgY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWYuZ2V0KGNvbnRhaW5lcikucHVzaChjaGlsZENvbXBvbmVudFJlZik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb250YWluZXJUb0NoaWxkQ29tcG9uZW50c1JlZi5zZXQoY29udGFpbmVyLCBbY2hpbGRDb21wb25lbnRSZWZdKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIHN1YnNjcmliZVRvQ29tcG9uZW50RGVzdHJveUV2ZW50KGFwcFJlZjogQXBwbGljYXRpb25SZWYsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWY6IENvbnRhaW5lclRvQ29tcG9uZW50c1JlZixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wb25lbnRSZWY6IENoaWxkQ29tcG9uZW50UmVmKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHN1YiA9IGNvbXBvbmVudFJlZi5pbnN0YW5jZS5kZXN0cm95LnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICBzdWIudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIE5neE5vdGlmaWNhdGlvbk1zZ1NlcnZpY2UuZGVzdHJveShhcHBSZWYsIGNvbXBvbmVudFJlZik7XG4gICAgICAgICAgICBOZ3hOb3RpZmljYXRpb25Nc2dTZXJ2aWNlLnJlbW92ZUNoaWxkQ29tcG9uZW50UmVmKGNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmLCBjb21wb25lbnRSZWYpO1xuICAgICAgICAgICAgTmd4Tm90aWZpY2F0aW9uTXNnU2VydmljZS51cGRhdGVDb21wb25lbnRzSW5kZXhlc09uRGVzdHJveShjb250YWluZXJUb0NoaWxkQ29tcG9uZW50c1JlZik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIGRlc3Ryb3koYXBwUmVmOiBBcHBsaWNhdGlvblJlZiwgY29tcG9uZW50UmVmOiBDaGlsZENvbXBvbmVudFJlZik6IHZvaWQge1xuICAgICAgICBhcHBSZWYuZGV0YWNoVmlldyhjb21wb25lbnRSZWYuaG9zdFZpZXcpO1xuICAgICAgICBjb21wb25lbnRSZWYuZGVzdHJveSgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIHVwZGF0ZUNvbXBvbmVudHNJbmRleGVzT25EZXN0cm95KGNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmOiBDb250YWluZXJUb0NvbXBvbmVudHNSZWYpOiB2b2lkIHtcbiAgICAgICAgY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWYuZm9yRWFjaCgodmFsdWUsIGtleSkgPT4ge1xuICAgICAgICAgICAgbGV0IHRvdGFsID0gY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWYuZ2V0KGtleSkubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgIGNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmLmdldChrZXkpLmZvckVhY2goKHtpbnN0YW5jZX0pID0+IHtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5pbmRleCA9IHRvdGFsLS07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVtb3ZlQ2hpbGRDb21wb25lbnRSZWYoY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWY6IENvbnRhaW5lclRvQ29tcG9uZW50c1JlZiwgY29tcG9uZW50UmVmOiBDaGlsZENvbXBvbmVudFJlZik6IHZvaWQge1xuICAgICAgICBjb250YWluZXJUb0NoaWxkQ29tcG9uZW50c1JlZi5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiB7XG4gICAgICAgICAgICBjb250YWluZXJUb0NoaWxkQ29tcG9uZW50c1JlZi5zZXQoa2V5LCBbLi4uY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWYuZ2V0KGtleSkuZmlsdGVyKF8gPT4gXyAhPT0gY29tcG9uZW50UmVmKV0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyB1cGRhdGVDb21wb25lbnRzSW5kZXhlc09uT3Blbihjb250YWluZXJUb0NoaWxkQ29tcG9uZW50c1JlZjogQ29udGFpbmVyVG9Db21wb25lbnRzUmVmKTogdm9pZCB7XG4gICAgICAgIGNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHtcbiAgICAgICAgICAgIGxldCB0b3RhbCA9IGNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmLmdldChrZXkpLmxlbmd0aDtcbiAgICAgICAgICAgIGNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmLmdldChrZXkpLmZvckVhY2goKHtpbnN0YW5jZX0pID0+IHtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5pbmRleCA9IC0tdG90YWw7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgb3BlbihpbnB1dHNDb25maWc6IElOZ3hOb3RpZmljYXRpb25Nc2dDb25maWcsIGVsZW1lbnQ/OiBFbGVtZW50KTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGVsZW1lbnQgPyBlbGVtZW50IDogdGhpcy5kZWZhdWx0Q29udGFpbmVyO1xuICAgICAgICBjb25zdCBjaGlsZENvbXBvbmVudFJlZiA9IE5neE5vdGlmaWNhdGlvbk1zZ1NlcnZpY2UuYXBwZW5kQ2hpbGRDb21wb25lbnRSZWYoXG4gICAgICAgICAgICB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgICAgICAgICAgIHRoaXMuYXBwUmVmLFxuICAgICAgICAgICAgdGhpcy5pbmplY3RvcixcbiAgICAgICAgICAgIGNvbnRhaW5lclxuICAgICAgICApO1xuXG4gICAgICAgIE5neE5vdGlmaWNhdGlvbk1zZ1NlcnZpY2UuYXR0YWNoQ29uZmlnKGlucHV0c0NvbmZpZywgY2hpbGRDb21wb25lbnRSZWYpO1xuICAgICAgICBOZ3hOb3RpZmljYXRpb25Nc2dTZXJ2aWNlLmFkZENoaWxkQ29tcG9uZW50UmVmKGNvbnRhaW5lciwgdGhpcy5jb250YWluZXJUb0NoaWxkQ29tcG9uZW50c1JlZiwgY2hpbGRDb21wb25lbnRSZWYpO1xuICAgICAgICBOZ3hOb3RpZmljYXRpb25Nc2dTZXJ2aWNlLnN1YnNjcmliZVRvQ29tcG9uZW50RGVzdHJveUV2ZW50KHRoaXMuYXBwUmVmLCB0aGlzLmNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmLCBjaGlsZENvbXBvbmVudFJlZik7XG4gICAgICAgIE5neE5vdGlmaWNhdGlvbk1zZ1NlcnZpY2UudXBkYXRlQ29tcG9uZW50c0luZGV4ZXNPbk9wZW4odGhpcy5jb250YWluZXJUb0NoaWxkQ29tcG9uZW50c1JlZik7XG4gICAgfVxufVxuXG50eXBlIENoaWxkQ29tcG9uZW50UmVmID0gQ29tcG9uZW50UmVmPE5neE5vdGlmaWNhdGlvbk1zZ0NvbXBvbmVudD47XG50eXBlIENvbnRhaW5lclRvQ29tcG9uZW50c1JlZiA9IE1hcDxFbGVtZW50LCBDaGlsZENvbXBvbmVudFJlZltdPjtcbiJdfQ==