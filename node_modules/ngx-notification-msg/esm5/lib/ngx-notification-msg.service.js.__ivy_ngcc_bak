/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ApplicationRef, ComponentFactoryResolver, Injectable, Injector } from '@angular/core';
import { NgxNotificationMsgComponent } from './ngx-notification-msg.component';
import * as i0 from "@angular/core";
var NgxNotificationMsgService = /** @class */ (function () {
    function NgxNotificationMsgService(componentFactoryResolver, appRef, injector) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.appRef = appRef;
        this.injector = injector;
        this.defaultContainer = document.querySelector('body');
        this.containerToChildComponentsRef = new Map();
    }
    /**
     * @private
     * @param {?} componentFactoryResolver
     * @param {?} appRef
     * @param {?} injector
     * @param {?} container
     * @return {?}
     */
    NgxNotificationMsgService.appendChildComponentRef = /**
     * @private
     * @param {?} componentFactoryResolver
     * @param {?} appRef
     * @param {?} injector
     * @param {?} container
     * @return {?}
     */
    function (componentFactoryResolver, appRef, injector, container) {
        /** @type {?} */
        var childComponentRef = componentFactoryResolver
            .resolveComponentFactory(NgxNotificationMsgComponent)
            .create(injector);
        /** @type {?} */
        var childDomElem = (/** @type {?} */ (((/** @type {?} */ (childComponentRef.hostView)))
            .rootNodes[0]));
        appRef.attachView(childComponentRef.hostView);
        container.appendChild(childDomElem);
        return childComponentRef;
    };
    /**
     * @private
     * @param {?} inputsConfig
     * @param {?} componentRef
     * @return {?}
     */
    NgxNotificationMsgService.attachConfig = /**
     * @private
     * @param {?} inputsConfig
     * @param {?} componentRef
     * @return {?}
     */
    function (inputsConfig, componentRef) {
        Object.keys(inputsConfig).forEach((/**
         * @param {?} key
         * @return {?}
         */
        function (key) {
            componentRef.instance[key] = inputsConfig[key];
        }));
    };
    /**
     * @private
     * @param {?} container
     * @param {?} containerToChildComponentsRef
     * @param {?} childComponentRef
     * @return {?}
     */
    NgxNotificationMsgService.addChildComponentRef = /**
     * @private
     * @param {?} container
     * @param {?} containerToChildComponentsRef
     * @param {?} childComponentRef
     * @return {?}
     */
    function (container, containerToChildComponentsRef, childComponentRef) {
        if (containerToChildComponentsRef.has(container)) {
            containerToChildComponentsRef.get(container).push(childComponentRef);
        }
        else {
            containerToChildComponentsRef.set(container, [childComponentRef]);
        }
    };
    /**
     * @private
     * @param {?} appRef
     * @param {?} containerToChildComponentsRef
     * @param {?} componentRef
     * @return {?}
     */
    NgxNotificationMsgService.subscribeToComponentDestroyEvent = /**
     * @private
     * @param {?} appRef
     * @param {?} containerToChildComponentsRef
     * @param {?} componentRef
     * @return {?}
     */
    function (appRef, containerToChildComponentsRef, componentRef) {
        /** @type {?} */
        var sub = componentRef.instance.destroy.subscribe((/**
         * @return {?}
         */
        function () {
            sub.unsubscribe();
            NgxNotificationMsgService.destroy(appRef, componentRef);
            NgxNotificationMsgService.removeChildComponentRef(containerToChildComponentsRef, componentRef);
            NgxNotificationMsgService.updateComponentsIndexesOnDestroy(containerToChildComponentsRef);
        }));
    };
    /**
     * @private
     * @param {?} appRef
     * @param {?} componentRef
     * @return {?}
     */
    NgxNotificationMsgService.destroy = /**
     * @private
     * @param {?} appRef
     * @param {?} componentRef
     * @return {?}
     */
    function (appRef, componentRef) {
        appRef.detachView(componentRef.hostView);
        componentRef.destroy();
    };
    /**
     * @private
     * @param {?} containerToChildComponentsRef
     * @return {?}
     */
    NgxNotificationMsgService.updateComponentsIndexesOnDestroy = /**
     * @private
     * @param {?} containerToChildComponentsRef
     * @return {?}
     */
    function (containerToChildComponentsRef) {
        containerToChildComponentsRef.forEach((/**
         * @param {?} value
         * @param {?} key
         * @return {?}
         */
        function (value, key) {
            /** @type {?} */
            var total = containerToChildComponentsRef.get(key).length - 1;
            containerToChildComponentsRef.get(key).forEach((/**
             * @param {?} __0
             * @return {?}
             */
            function (_a) {
                var instance = _a.instance;
                instance.index = total--;
            }));
        }));
    };
    /**
     * @private
     * @param {?} containerToChildComponentsRef
     * @param {?} componentRef
     * @return {?}
     */
    NgxNotificationMsgService.removeChildComponentRef = /**
     * @private
     * @param {?} containerToChildComponentsRef
     * @param {?} componentRef
     * @return {?}
     */
    function (containerToChildComponentsRef, componentRef) {
        containerToChildComponentsRef.forEach((/**
         * @param {?} value
         * @param {?} key
         * @return {?}
         */
        function (value, key) {
            containerToChildComponentsRef.set(key, tslib_1.__spread(containerToChildComponentsRef.get(key).filter((/**
             * @param {?} _
             * @return {?}
             */
            function (_) { return _ !== componentRef; }))));
        }));
    };
    /**
     * @private
     * @param {?} containerToChildComponentsRef
     * @return {?}
     */
    NgxNotificationMsgService.updateComponentsIndexesOnOpen = /**
     * @private
     * @param {?} containerToChildComponentsRef
     * @return {?}
     */
    function (containerToChildComponentsRef) {
        containerToChildComponentsRef.forEach((/**
         * @param {?} value
         * @param {?} key
         * @return {?}
         */
        function (value, key) {
            /** @type {?} */
            var total = containerToChildComponentsRef.get(key).length;
            containerToChildComponentsRef.get(key).forEach((/**
             * @param {?} __0
             * @return {?}
             */
            function (_a) {
                var instance = _a.instance;
                instance.index = --total;
            }));
        }));
    };
    /**
     * @param {?} inputsConfig
     * @param {?=} element
     * @return {?}
     */
    NgxNotificationMsgService.prototype.open = /**
     * @param {?} inputsConfig
     * @param {?=} element
     * @return {?}
     */
    function (inputsConfig, element) {
        /** @type {?} */
        var container = element ? element : this.defaultContainer;
        /** @type {?} */
        var childComponentRef = NgxNotificationMsgService.appendChildComponentRef(this.componentFactoryResolver, this.appRef, this.injector, container);
        NgxNotificationMsgService.attachConfig(inputsConfig, childComponentRef);
        NgxNotificationMsgService.addChildComponentRef(container, this.containerToChildComponentsRef, childComponentRef);
        NgxNotificationMsgService.subscribeToComponentDestroyEvent(this.appRef, this.containerToChildComponentsRef, childComponentRef);
        NgxNotificationMsgService.updateComponentsIndexesOnOpen(this.containerToChildComponentsRef);
    };
    NgxNotificationMsgService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    NgxNotificationMsgService.ctorParameters = function () { return [
        { type: ComponentFactoryResolver },
        { type: ApplicationRef },
        { type: Injector }
    ]; };
    /** @nocollapse */ NgxNotificationMsgService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function NgxNotificationMsgService_Factory() { return new NgxNotificationMsgService(i0.ɵɵinject(i0.ComponentFactoryResolver), i0.ɵɵinject(i0.ApplicationRef), i0.ɵɵinject(i0.INJECTOR)); }, token: NgxNotificationMsgService, providedIn: "root" });
    return NgxNotificationMsgService;
}());
export { NgxNotificationMsgService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    NgxNotificationMsgService.prototype.defaultContainer;
    /**
     * @type {?}
     * @private
     */
    NgxNotificationMsgService.prototype.containerToChildComponentsRef;
    /**
     * @type {?}
     * @private
     */
    NgxNotificationMsgService.prototype.componentFactoryResolver;
    /**
     * @type {?}
     * @private
     */
    NgxNotificationMsgService.prototype.appRef;
    /**
     * @type {?}
     * @private
     */
    NgxNotificationMsgService.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LW5vdGlmaWNhdGlvbi1tc2cuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1ub3RpZmljYXRpb24tbXNnLyIsInNvdXJjZXMiOlsibGliL25neC1ub3RpZmljYXRpb24tbXNnLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUMsY0FBYyxFQUFFLHdCQUF3QixFQUFpQyxVQUFVLEVBQUUsUUFBUSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQzVILE9BQU8sRUFBNEIsMkJBQTJCLEVBQUMsTUFBTSxrQ0FBa0MsQ0FBQzs7QUFFeEc7SUFRSSxtQ0FBNkIsd0JBQWtELEVBQ2xELE1BQXNCLEVBQ3RCLFFBQWtCO1FBRmxCLDZCQUF3QixHQUF4Qix3QkFBd0IsQ0FBMEI7UUFDbEQsV0FBTSxHQUFOLE1BQU0sQ0FBZ0I7UUFDdEIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUw5QixxQkFBZ0IsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2xELGtDQUE2QixHQUFHLElBQUksR0FBRyxFQUFnQyxDQUFDO0lBS3pGLENBQUM7Ozs7Ozs7OztJQUVjLGlEQUF1Qjs7Ozs7Ozs7SUFBdEMsVUFBdUMsd0JBQWtELEVBQ2xELE1BQXNCLEVBQ3RCLFFBQWtCLEVBQ2xCLFNBQWtCOztZQUMvQyxpQkFBaUIsR0FBRyx3QkFBd0I7YUFDN0MsdUJBQXVCLENBQUMsMkJBQTJCLENBQUM7YUFDcEQsTUFBTSxDQUFDLFFBQVEsQ0FBQzs7WUFDZixZQUFZLEdBQUcsbUJBQUEsQ0FBQyxtQkFBQSxpQkFBaUIsQ0FBQyxRQUFRLEVBQXdCLENBQUM7YUFDcEUsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFlO1FBRWhDLE1BQU0sQ0FBQyxVQUFVLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDOUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUVwQyxPQUFPLGlCQUFpQixD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e0FwcGxpY2F0aW9uUmVmLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIENvbXBvbmVudFJlZiwgRW1iZWRkZWRWaWV3UmVmLCBJbmplY3RhYmxlLCBJbmplY3Rvcn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0lOZ3hOb3RpZmljYXRpb25Nc2dDb25maWcsIE5neE5vdGlmaWNhdGlvbk1zZ0NvbXBvbmVudH0gZnJvbSAnLi9uZ3gtbm90aWZpY2F0aW9uLW1zZy5jb21wb25lbnQnO1xuXG5ASW5qZWN0YWJsZSh7XG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIE5neE5vdGlmaWNhdGlvbk1zZ1NlcnZpY2Uge1xuXG4gICAgcHJpdmF0ZSByZWFkb25seSBkZWZhdWx0Q29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWYgPSBuZXcgTWFwPEVsZW1lbnQsIENoaWxkQ29tcG9uZW50UmVmW10+KCk7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgcmVhZG9ubHkgYXBwUmVmOiBBcHBsaWNhdGlvblJlZixcbiAgICAgICAgICAgICAgICBwcml2YXRlIHJlYWRvbmx5IGluamVjdG9yOiBJbmplY3Rvcikge1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIGFwcGVuZENoaWxkQ29tcG9uZW50UmVmKGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcFJlZjogQXBwbGljYXRpb25SZWYsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5qZWN0b3I6IEluamVjdG9yLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogRWxlbWVudCk6IENoaWxkQ29tcG9uZW50UmVmIHtcbiAgICAgICAgY29uc3QgY2hpbGRDb21wb25lbnRSZWYgPSBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXJcbiAgICAgICAgICAgIC5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShOZ3hOb3RpZmljYXRpb25Nc2dDb21wb25lbnQpXG4gICAgICAgICAgICAuY3JlYXRlKGluamVjdG9yKTtcbiAgICAgICAgY29uc3QgY2hpbGREb21FbGVtID0gKGNoaWxkQ29tcG9uZW50UmVmLmhvc3RWaWV3IGFzIEVtYmVkZGVkVmlld1JlZjxhbnk+KVxuICAgICAgICAgICAgLnJvb3ROb2Rlc1swXSBhcyBIVE1MRWxlbWVudDtcblxuICAgICAgICBhcHBSZWYuYXR0YWNoVmlldyhjaGlsZENvbXBvbmVudFJlZi5ob3N0Vmlldyk7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjaGlsZERvbUVsZW0pO1xuXG4gICAgICAgIHJldHVybiBjaGlsZENvbXBvbmVudFJlZjtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBhdHRhY2hDb25maWcoaW5wdXRzQ29uZmlnOiBJTmd4Tm90aWZpY2F0aW9uTXNnQ29uZmlnLCBjb21wb25lbnRSZWYpOiB2b2lkIHtcbiAgICAgICAgT2JqZWN0LmtleXMoaW5wdXRzQ29uZmlnKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgICAgICBjb21wb25lbnRSZWYuaW5zdGFuY2Vba2V5XSA9IGlucHV0c0NvbmZpZ1trZXldO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBhZGRDaGlsZENvbXBvbmVudFJlZihjb250YWluZXI6IEVsZW1lbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWY6IENvbnRhaW5lclRvQ29tcG9uZW50c1JlZixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZENvbXBvbmVudFJlZjogQ2hpbGRDb21wb25lbnRSZWYpOiB2b2lkIHtcbiAgICAgICAgaWYgKGNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmLmhhcyhjb250YWluZXIpKSB7XG4gICAgICAgICAgICBjb250YWluZXJUb0NoaWxkQ29tcG9uZW50c1JlZi5nZXQoY29udGFpbmVyKS5wdXNoKGNoaWxkQ29tcG9uZW50UmVmKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmLnNldChjb250YWluZXIsIFtjaGlsZENvbXBvbmVudFJlZl0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgc3Vic2NyaWJlVG9Db21wb25lbnREZXN0cm95RXZlbnQoYXBwUmVmOiBBcHBsaWNhdGlvblJlZixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXJUb0NoaWxkQ29tcG9uZW50c1JlZjogQ29udGFpbmVyVG9Db21wb25lbnRzUmVmLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudFJlZjogQ2hpbGRDb21wb25lbnRSZWYpOiB2b2lkIHtcbiAgICAgICAgY29uc3Qgc3ViID0gY29tcG9uZW50UmVmLmluc3RhbmNlLmRlc3Ryb3kuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIHN1Yi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgTmd4Tm90aWZpY2F0aW9uTXNnU2VydmljZS5kZXN0cm95KGFwcFJlZiwgY29tcG9uZW50UmVmKTtcbiAgICAgICAgICAgIE5neE5vdGlmaWNhdGlvbk1zZ1NlcnZpY2UucmVtb3ZlQ2hpbGRDb21wb25lbnRSZWYoY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWYsIGNvbXBvbmVudFJlZik7XG4gICAgICAgICAgICBOZ3hOb3RpZmljYXRpb25Nc2dTZXJ2aWNlLnVwZGF0ZUNvbXBvbmVudHNJbmRleGVzT25EZXN0cm95KGNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZGVzdHJveShhcHBSZWY6IEFwcGxpY2F0aW9uUmVmLCBjb21wb25lbnRSZWY6IENoaWxkQ29tcG9uZW50UmVmKTogdm9pZCB7XG4gICAgICAgIGFwcFJlZi5kZXRhY2hWaWV3KGNvbXBvbmVudFJlZi5ob3N0Vmlldyk7XG4gICAgICAgIGNvbXBvbmVudFJlZi5kZXN0cm95KCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgdXBkYXRlQ29tcG9uZW50c0luZGV4ZXNPbkRlc3Ryb3koY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWY6IENvbnRhaW5lclRvQ29tcG9uZW50c1JlZik6IHZvaWQge1xuICAgICAgICBjb250YWluZXJUb0NoaWxkQ29tcG9uZW50c1JlZi5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiB7XG4gICAgICAgICAgICBsZXQgdG90YWwgPSBjb250YWluZXJUb0NoaWxkQ29tcG9uZW50c1JlZi5nZXQoa2V5KS5sZW5ndGggLSAxO1xuICAgICAgICAgICAgY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWYuZ2V0KGtleSkuZm9yRWFjaCgoe2luc3RhbmNlfSkgPT4ge1xuICAgICAgICAgICAgICAgIGluc3RhbmNlLmluZGV4ID0gdG90YWwtLTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyByZW1vdmVDaGlsZENvbXBvbmVudFJlZihjb250YWluZXJUb0NoaWxkQ29tcG9uZW50c1JlZjogQ29udGFpbmVyVG9Db21wb25lbnRzUmVmLCBjb21wb25lbnRSZWY6IENoaWxkQ29tcG9uZW50UmVmKTogdm9pZCB7XG4gICAgICAgIGNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHtcbiAgICAgICAgICAgIGNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmLnNldChrZXksIFsuLi5jb250YWluZXJUb0NoaWxkQ29tcG9uZW50c1JlZi5nZXQoa2V5KS5maWx0ZXIoXyA9PiBfICE9PSBjb21wb25lbnRSZWYpXSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIHVwZGF0ZUNvbXBvbmVudHNJbmRleGVzT25PcGVuKGNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmOiBDb250YWluZXJUb0NvbXBvbmVudHNSZWYpOiB2b2lkIHtcbiAgICAgICAgY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWYuZm9yRWFjaCgodmFsdWUsIGtleSkgPT4ge1xuICAgICAgICAgICAgbGV0IHRvdGFsID0gY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWYuZ2V0KGtleSkubGVuZ3RoO1xuICAgICAgICAgICAgY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWYuZ2V0KGtleSkuZm9yRWFjaCgoe2luc3RhbmNlfSkgPT4ge1xuICAgICAgICAgICAgICAgIGluc3RhbmNlLmluZGV4ID0gLS10b3RhbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBvcGVuKGlucHV0c0NvbmZpZzogSU5neE5vdGlmaWNhdGlvbk1zZ0NvbmZpZywgZWxlbWVudD86IEVsZW1lbnQpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gZWxlbWVudCA/IGVsZW1lbnQgOiB0aGlzLmRlZmF1bHRDb250YWluZXI7XG4gICAgICAgIGNvbnN0IGNoaWxkQ29tcG9uZW50UmVmID0gTmd4Tm90aWZpY2F0aW9uTXNnU2VydmljZS5hcHBlbmRDaGlsZENvbXBvbmVudFJlZihcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICAgICAgICAgICAgdGhpcy5hcHBSZWYsXG4gICAgICAgICAgICB0aGlzLmluamVjdG9yLFxuICAgICAgICAgICAgY29udGFpbmVyXG4gICAgICAgICk7XG5cbiAgICAgICAgTmd4Tm90aWZpY2F0aW9uTXNnU2VydmljZS5hdHRhY2hDb25maWcoaW5wdXRzQ29uZmlnLCBjaGlsZENvbXBvbmVudFJlZik7XG4gICAgICAgIE5neE5vdGlmaWNhdGlvbk1zZ1NlcnZpY2UuYWRkQ2hpbGRDb21wb25lbnRSZWYoY29udGFpbmVyLCB0aGlzLmNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmLCBjaGlsZENvbXBvbmVudFJlZik7XG4gICAgICAgIE5neE5vdGlmaWNhdGlvbk1zZ1NlcnZpY2Uuc3Vic2NyaWJlVG9Db21wb25lbnREZXN0cm95RXZlbnQodGhpcy5hcHBSZWYsIHRoaXMuY29udGFpbmVyVG9DaGlsZENvbXBvbmVudHNSZWYsIGNoaWxkQ29tcG9uZW50UmVmKTtcbiAgICAgICAgTmd4Tm90aWZpY2F0aW9uTXNnU2VydmljZS51cGRhdGVDb21wb25lbnRzSW5kZXhlc09uT3Blbih0aGlzLmNvbnRhaW5lclRvQ2hpbGRDb21wb25lbnRzUmVmKTtcbiAgICB9XG59XG5cbnR5cGUgQ2hpbGRDb21wb25lbnRSZWYgPSBDb21wb25lbnRSZWY8Tmd4Tm90aWZpY2F0aW9uTXNnQ29tcG9uZW50PjtcbnR5cGUgQ29udGFpbmVyVG9Db21wb25lbnRzUmVmID0gTWFwPEVsZW1lbnQsIENoaWxkQ29tcG9uZW50UmVmW10+O1xuIl19